# Pixory â€“ Image Cloud Backend

Pixory is an AI-powered backend service that handles secure image uploads, cloud storage, AI-based image analysis, and persistent metadata management.

This repository contains the backend system responsible for storage, intelligence, and API orchestration.

---

## Tech Stack

- **Framework:** Spring Boot 3.2.2
- **Language:** Java 17
- **Security:** Spring Security, JWT (Access + Refresh Tokens)
- **Database:** Spring Data JPA / Hibernate, MySQL
- **Cloud:** Cloudinary (Image Storage & CDN)
- **AI:** Google Gemini API (gemini-1.5-flash / gemini-2.5-flash)
- **Email:** Spring Boot Starter Mail (JavaMailSender)
- **Build:** Apache Maven
- **Utilities:** Lombok, Thumbnailator

---

## Prerequisites

- **Java 17:** Make sure you have JDK 17 installed.
- **Apache Maven:** For building and running the project.
- **MySQL:** A running instance of MySQL database.
- **SMTP Server:** A Gmail account (or other SMTP) with App Password for sending emails.

---

## Getting Started

Follow these steps to get the project running on your local machine.

**1. Clone the repository:**
```sh
git clone https://github.com/your-username/pixory-image-cloud-backend.git
cd pixory-image-cloud-backend
```

**2. Configure the environment:**

The project uses a `.env` file (or system environment variables) to manage secrets.

- Copy the example file:
  ```sh
  cp env.example .env
  ```
- Edit the `.env` file with your credentials:

| Variable | Description |
| :--- | :--- |
| `DB_URL` | JDBC URL for MySQL (e.g., `jdbc:mysql://localhost:3306/gallary_db`) |
| `DB_USER` | Database Username |
| `DB_PASS` | Database Password |
| `CLOUDINARY_CLOUD_NAME` | Cloudinary Cloud Name |
| `CLOUDINARY_API_KEY` | Cloudinary API Key |
| `CLOUDINARY_API_SECRET` | Cloudinary API Secret |
| `GEMINI_API_KEY` | Google Gemini API Key |
| `JWT_SECRET` | 256-bit secret key for JWT signing |
| `MAIL_USERNAME` | Email address for sending notifications (e.g., Gmail) |
| `MAIL_PASSWORD` | App Password for the email account |

**3. Run the application:**
```sh
mvn spring-boot:run
```
The application will start on port `8092` by default.

---

## API Endpoints

All endpoints are authenticated using a Bearer Token in the `Authorization` header, except for Authorization endpoints.

### Authentication & Recovery
- `POST /api/auth/register`: Register a new user. (Sends Welcome Email)
  - **Returns:** `{ "accessToken": "...", "refreshToken": "..." }`
- `POST /api/auth/login`: Log in.
  - **Returns:** `{ "accessToken": "...", "refreshToken": "..." }`
- `POST /api/auth/refresh-token`: Get a new access token using a refresh token.
  - **Body:** `{ "refreshToken": "..." }`
- `POST /api/auth/forgot-password`: Request a password reset. (Sends Reset Email)
  - **Body:** `{ "email": "..." }`
- `POST /api/auth/reset-password`: Reset password using the token received via email.
  - **Body:** `{ "token": "...", "newPassword": "..." }`

### Files
- `POST /api/v1/files/upload`: Upload a new image (multipart/form-data).
- `GET /api/v1/files/me`: Get all files uploaded by the current user.
- `GET /api/v1/files/search`: Search for files. (e.g., `/search?query=cats`)
- `GET /api/v1/files/{id}`: Get details for a specific file.
- `DELETE /api/v1/files/{id}`: Delete a specific file.

---

## System Flow

1. **User Registration**: User signs up -> Welcome Email sent -> Tokens issued.
2. **File Upload**: Client uploads image -> Backend saves to Cloudinary -> Asynchronously triggers AI analysis.
3. **AI Processing**: Dedicated service resizes image -> Sends to Gemini AI -> Updates DB with description & tags.
4. **Search**: Users can search their gallery using natural language tags generated by AI.

---

## Key Engineering Decisions

### Asynchronous AI Processing
AI analysis is resource-intensive and potentially slow. We implemented a dedicated `ImageAnalysisService` annotated with `@Async`. This allows the file upload request to complete immediately (returning the file info to the user), while the AI analysis happens in the background. The user sees "Analysis pending..." until the process completes.

### JWT Refresh Token Flow
To improve security, Access Tokens are short-lived (15 minutes). We implemented a Refresh Token flow (valid for 7 days) allowing the frontend to silently acquire new access tokens without forcing the user to log out.

### Email Integration
We use `spring-boot-starter-mail` with asynchronous execution to send transactional emails (Welcome, Password Reset) without blocking the main request thread.

---

## Project Status

- Core upload pipeline: âœ… Complete
- Cloud storage integration: âœ… Stable
- AI image analysis: âœ… Optimized & Async
- Authentication (JWT + Refresh): âœ… Complete
- Password Recovery & Email: âœ… Complete
- Unit Testing: âœ… Started

---

## Related Repository

Frontend application:
ðŸ‘‰ https://github.com/RohitSalv/pixory-image-cloud-frontend

---

## License

This project is intended for learning, portfolio demonstration, and experimentation.
